#!/usr/bin/env node

var fs = require('q-io/fs');

module.exports = function(title, config){
  var timestamp = +(new Date)
    , filename  = timestamp+"_"+title.replace(/\s/g, "_")+".json"
    , filepath  = config.base+(config.migrations||'migrations')+'/'
    , migration = {
        author:      ""
      , description: title
      , created_at:  timestamp
      , up:   ['']
      , down: ['']
      }
    ;

    migration = JSON.stringify(migration, null, "\t");

    fs.isDirectory(filepath)
      .then(function(is_directory){
        if(!is_directory){
          return fs.makeDirectory(filepath);
        }
      })
      .then(function(){
        fs.write(filepath+filename, migration)
        .then(function(res){
          console.log(filepath+filename+" has been written");
        });
    });
}
